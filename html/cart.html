<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Coșul tău de cumpărături la Leyr. - Printare 3D profesională pentru figurine, cercei și bijuterii">
<title>Leyr. — Coș</title>
<link rel="icon" href="../imgages/logo3.ico">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../css/cart.css">
<script>
// Theme toggle function - MUST be defined in head before body loads
window.toggleTheme = function() {
  console.log('=== toggleTheme called (head - cart) ===');
  const currentTheme = localStorage.getItem('theme') || 'light';
  const newTheme = currentTheme === 'light' ? 'dark' : 'light';
  localStorage.setItem('theme', newTheme);
  document.documentElement.setAttribute('data-theme', newTheme);
  
  const themeToggle = document.getElementById('themeToggle');
  if (themeToggle) {
    const sunIcon = themeToggle.querySelector('.sun-icon');
    const moonIcon = themeToggle.querySelector('.moon-icon');
    if (sunIcon && moonIcon) {
      // Show the opposite icon (the one you can switch to)
      if (newTheme === 'dark') {
        // Theme is dark, show sun icon (to switch to light)
        sunIcon.style.display = 'block';
        moonIcon.style.display = 'none';
        themeToggle.classList.remove('dark-active');
      } else {
        // Theme is light, show moon icon (to switch to dark)
        sunIcon.style.display = 'none';
        moonIcon.style.display = 'block';
        themeToggle.classList.add('dark-active');
      }
    }
  }
};
</script>
</head>
<body>

<header>
  <img src="../imgages/logo1.png" alt="Leyr." onclick="window.location.href='index.html'">
  <div class="header-controls">
    <div class="cart-toggle-wrapper">
      <a href="cart.html" class="toggle-btn cart-toggle" id="cartToggle" aria-label="Cart">
        <span class="toggle-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
        </span>
      </a>
      <span class="cart-badge" id="cartBadge">0</span>
    </div>
    <button class="toggle-btn language-toggle" id="languageToggle" onclick="toggleLanguage()" aria-label="Language">
      <span class="toggle-icon" id="languageToggleText">EN</span>
    </button>
    <button class="toggle-btn theme-toggle" id="themeToggle" onclick="toggleTheme()" aria-label="Toggle theme">
      <span class="toggle-icon">
        <svg class="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg class="moon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </span>
    </button>
  </div>
  <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu">
    <span></span>
    <span></span>
    <span></span>
  </button>
  <nav id="navMenu">
    <a href="index.html" data-i18n="navHome">Acasă</a>
    <a href="catalogue.html" data-i18n="navProducts">Produse</a>
    <a href="services.html" data-i18n="navServices">Servicii</a>
    <a href="contact.html" data-i18n="navContact">Contactează-ne</a>
  </nav>
</header>

<section class="cart-container">
  <h2 class="cart-title" data-i18n="cartTitle">Coșul Tău</h2>
  <div id="cartItems"></div>
  <div id="emptyMsg" class="empty-cart" style="display: none;">
    <span data-i18n="emptyCart">Coșul tău este gol.</span>
    <button class="shop-now-btn" onclick="window.location.href='catalogue.html'" data-i18n="shopNow">Cumpără Acum!</button>
  </div>
  <div id="cartSummary" class="cart-summary" style="display: none;">
    <div class="summary-row">
      <span data-i18n="subtotal">Subtotal:</span>
      <span id="subtotal">$0.00</span>
    </div>
    <div class="summary-row total">
      <span data-i18n="total">Total:</span>
      <span id="total">$0.00</span>
    </div>
    <button id="checkoutBtn" class="checkout-btn" data-i18n="checkoutBtn">Finalizează prin WhatsApp</button>
  </div>
</section>

<script>
// Language translations for cart page
const translations = {
  ro: {
    navHome: 'Acasă',
    navProducts: 'Produse',
    navServices: 'Servicii',
    navContact: 'Contactează-ne',
    navCart: 'Coș',
    cartTitle: 'Coșul Tău',
    emptyCart: 'Coșul tău este gol.',
    shopNow: 'Cumpără Acum!',
    subtotal: 'Subtotal:',
    total: 'Total:',
    checkoutBtn: 'Finalizează prin WhatsApp',
    each: 'fiecare',
    remove: 'Elimină',
    contactTitle: 'Contactează-ne',
    order: 'Comandă'
  },
  en: {
    navHome: 'Home',
    navProducts: 'Our Products',
    navServices: 'Our Services',
    navContact: 'Contact Us',
    navCart: 'Cart',
    cartTitle: 'Your Cart',
    emptyCart: 'Your cart is empty.',
    shopNow: 'Shop Now!',
    subtotal: 'Subtotal:',
    total: 'Total:',
    checkoutBtn: 'Checkout via WhatsApp',
    each: 'each',
    remove: 'Remove',
    contactTitle: 'Contact Us',
    order: 'Order'
  }
};

// Language toggle function
window.toggleLanguage = function() {
  let currentLang = localStorage.getItem('language');
  if (!currentLang) {
    currentLang = 'ro';
    localStorage.setItem('language', 'ro');
  }
  const newLang = currentLang === 'ro' ? 'en' : 'ro';
  setLanguage(newLang);
};

function setLanguage(lang) {
  localStorage.setItem('language', lang);
  document.documentElement.setAttribute('lang', lang);
  
  const languageToggleText = document.getElementById('languageToggleText');
  if (languageToggleText) {
    // Show the opposite language (the one you can switch to)
    const oppositeLang = lang === 'ro' ? 'EN' : 'RO';
    languageToggleText.textContent = oppositeLang;
  }
  
  updatePageContent(lang);
}

function updatePageContent(lang) {
  const t = translations[lang];
  if (!t) return;
  
  // Update all elements with data-i18n attribute
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (t[key]) {
      el.textContent = t[key];
    }
  });
  
  // Re-render cart to update dynamic content
  renderCart();
  
  // Update page title
  if (lang === 'en') {
    document.title = 'Leyr. — Cart';
  } else {
    document.title = 'Leyr. — Coș';
  }
}

const mobileMenuToggle = document.getElementById('mobileMenuToggle');
const navMenu = document.getElementById('navMenu');

if (mobileMenuToggle) {
  mobileMenuToggle.addEventListener('click', () => {
    navMenu.classList.toggle('active');
  });
  
  const navLinks = navMenu.querySelectorAll('a');
  navLinks.forEach(link => {
    link.addEventListener('click', () => {
      if (window.innerWidth <= 768) {
        navMenu.classList.remove('active');
      }
    });
  });
}

// CART LOGIC
let cart = [];

// Load cart from localStorage with error handling
try {
  const cartData = localStorage.getItem('cart');
  cart = cartData ? JSON.parse(cartData) : [];
  // Ensure cart items have required properties - normalize quantity to qty
  cart = cart.map(item => {
    // Normalize quantity to qty - use qty if exists, otherwise quantity
    const qty = item.qty !== undefined ? item.qty : (item.quantity !== undefined ? item.quantity : 1);
    return {
      ...item, // Keep all properties including id
      name: item.name || 'Unknown Product',
      price: item.price || 0,
      img: item.img || 'placeholder.jpg',
      qty: qty
    };
  });
} catch (error) {
  console.error('Error loading cart:', error);
  cart = [];
}

const cartItemsDiv = document.getElementById('cartItems');
const emptyMsg = document.getElementById('emptyMsg');
const cartSummary = document.getElementById('cartSummary');
const checkoutBtn = document.getElementById('checkoutBtn');

function saveCart() {
  try {
    localStorage.setItem('cart', JSON.stringify(cart));
  } catch (error) {
    console.error('Error saving cart:', error);
    alert('Unable to save cart. Please try again.');
  }
}

function renderCart() {
  cartItemsDiv.innerHTML = '';
  
  const lang = localStorage.getItem('language') || 'ro';
  const t = translations[lang];
  
  if (cart.length === 0) {
    emptyMsg.style.display = 'block';
    cartSummary.style.display = 'none';
    return;
  }
  
  emptyMsg.style.display = 'none';
  cartSummary.style.display = 'block';
  
  let subtotal = 0;
  
  cart.forEach((item, index) => {
    const itemTotal = (item.price || 0) * (item.qty || 1);
    subtotal += itemTotal;
    
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `
      <img src="${item.img || 'placeholder.jpg'}" alt="${item.name}" onerror="this.src='placeholder.jpg'">
      <div class="cart-item-details">
        <h3>${item.name}</h3>
        <div class="cart-item-price">$${(item.price || 0).toFixed(2)} ${t.each}</div>
        <div class="qty-controls">
          <button class="dec" aria-label="Decrease quantity">-</button>
          <span>${item.qty || 1}</span>
          <button class="inc" aria-label="Increase quantity">+</button>
        </div>
      </div>
      <button class="remove-item-btn" aria-label="Remove item">${t.remove}</button>
    `;
    
    cartItemsDiv.appendChild(div);
    
    // Quantity controls
    const incBtn = div.querySelector('.inc');
    const decBtn = div.querySelector('.dec');
    const removeBtn = div.querySelector('.remove-item-btn');
    
    incBtn.addEventListener('click', () => {
      item.qty = (item.qty || 1) + 1;
      saveCart();
      renderCart();
    });
    
    decBtn.addEventListener('click', () => {
      if (item.qty > 1) {
        item.qty--;
      } else {
        cart = cart.filter((_, i) => i !== index);
      }
      saveCart();
      renderCart();
    });
    
    removeBtn.addEventListener('click', () => {
      cart = cart.filter((_, i) => i !== index);
      saveCart();
      renderCart();
    });
  });
  
  // Update summary
  document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
  document.getElementById('total').textContent = `$${subtotal.toFixed(2)}`;
}

checkoutBtn.addEventListener('click', () => {
  if (cart.length === 0) return;
  
  const lang = localStorage.getItem('language') || 'ro';
  const t = translations[lang];
  
  let msg = `Leyr. ${t.order}:%0A%0A`;
  let total = 0;
  
  cart.forEach(item => {
    const itemTotal = (item.price || 0) * (item.qty || 1);
    total += itemTotal;
    msg += `${item.name} x${item.qty || 1} - $${itemTotal.toFixed(2)}%0A`;
  });
  
  msg += `%0A${t.total} $${total.toFixed(2)}`;
  
  window.open(`https://wa.me/40771728217?text=${msg}`, '_blank');
});

// Theme toggle function
window.toggleTheme = function() {
  console.log('=== toggleTheme called (cart) ===');
  const currentTheme = localStorage.getItem('theme') || 'light';
  console.log('Current theme:', currentTheme);
  const newTheme = currentTheme === 'light' ? 'dark' : 'light';
  console.log('Switching to theme:', newTheme);
  setTheme(newTheme);
};

// Theme function
function setTheme(theme) {
  console.log('=== setTheme called with:', theme, '(cart) ===');
  localStorage.setItem('theme', theme);
  console.log('Theme saved to localStorage:', theme);
  
  document.documentElement.setAttribute('data-theme', theme);
  console.log('data-theme attribute set on html element:', document.documentElement.getAttribute('data-theme'));
  
  const themeToggle = document.getElementById('themeToggle');
  console.log('Looking for themeToggle element...');
  if (themeToggle) {
    console.log('Found themeToggle element:', themeToggle);
    const sunIcon = themeToggle.querySelector('.sun-icon');
    const moonIcon = themeToggle.querySelector('.moon-icon');
    console.log('Sun icon found:', !!sunIcon);
    console.log('Moon icon found:', !!moonIcon);
    
    if (sunIcon && moonIcon) {
      // Show the opposite icon (the one you can switch to)
      if (theme === 'dark') {
        // Theme is dark, show sun icon (to switch to light)
        sunIcon.style.display = 'block';
        moonIcon.style.display = 'none';
        themeToggle.classList.remove('dark-active');
        console.log('Theme set to dark - showing sun icon (can switch to light)');
      } else {
        // Theme is light, show moon icon (to switch to dark)
        sunIcon.style.display = 'none';
        moonIcon.style.display = 'block';
        themeToggle.classList.add('dark-active');
        console.log('Theme set to light - showing moon icon (can switch to dark)');
      }
    } else {
      console.error('Sun or moon icon NOT found!');
      console.log('Available children:', Array.from(themeToggle.children).map(c => c.tagName + (c.className ? '.' + c.className : '')));
    }
  } else {
    console.error('themeToggle element NOT found!');
  }
  console.log('=== setTheme finished (cart) ===');
}

// Initialize language on page load
let savedLang = localStorage.getItem('language');
if (!savedLang) {
  savedLang = 'ro';
  localStorage.setItem('language', 'ro');
}
setLanguage(savedLang);

// Update cart badge count
function updateCartBadge() {
  const cartBadge = document.getElementById('cartBadge');
  if (!cartBadge) return;
  
  try {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const totalItems = cart.reduce((sum, item) => sum + (item.quantity || item.qty || 1), 0);
    
    if (totalItems > 0) {
      cartBadge.textContent = totalItems;
      cartBadge.style.display = 'flex';
    } else {
      cartBadge.style.display = 'none';
    }
  } catch (error) {
    console.error('Error updating cart badge:', error);
    cartBadge.style.display = 'none';
  }
}

// Initialize theme on page load
const savedTheme = localStorage.getItem('theme') || 'light';
setTheme(savedTheme);

// Initialize cart badge on page load
updateCartBadge();

// Listen for storage changes to sync language and theme across all open pages
window.addEventListener('storage', function(e) {
  if (e.key === 'language') {
    const newLang = e.newValue || 'ro';
    setLanguage(newLang);
  }
  if (e.key === 'theme') {
    const newTheme = e.newValue || 'light';
    setTheme(newTheme);
  }
  if (e.key === 'cart') {
    updateCartBadge();
  }
});

// Also check cart on page focus (for same-tab updates)
window.addEventListener('focus', updateCartBadge);

// Letter-by-letter animation for shop now button
function wrapLettersInShopButton() {
  const shopButton = document.querySelector('.shop-now-btn');
  if (!shopButton) return;
  
  // Skip if already wrapped
  if (shopButton.querySelector('.letter')) {
    return;
  }
  
  const text = shopButton.textContent.trim();
  shopButton.innerHTML = '';
  
  // Split text into characters (including spaces)
  const letters = text.split('');
  
  letters.forEach((letter, index) => {
    const span = document.createElement('span');
    span.className = 'letter';
    span.textContent = letter === ' ' ? '\u00A0' : letter; // Non-breaking space for regular spaces
    span.style.transitionDelay = `${index * 0.03}s`; // Progressive delay
    shopButton.appendChild(span);
  });
}

// Wrap letters after cart render and language change
const originalRenderCart = renderCart;
renderCart = function() {
  originalRenderCart();
  // Update cart badge
  updateCartBadge();
  // Wrap letters after a short delay to ensure button is rendered
  setTimeout(wrapLettersInShopButton, 50);
};

const originalUpdatePageContent = updatePageContent;
updatePageContent = function(lang) {
  originalUpdatePageContent(lang);
  // Re-wrap letters after language change
  setTimeout(wrapLettersInShopButton, 100);
};

// Initial render
renderCart();
</script>

<section class="contact-section">
  <div class="contact-container">
    <h2 data-i18n="contactTitle">Contactează-ne</h2>
    <div class="contact-info">
      <a href="https://www.instagram.com/leyr.ro?igsh=MTk0bXoxMmxvdmFucg==" target="_blank" class="contact-link">
        <span class="contact-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="2" y="2" width="20" height="20" rx="5" stroke="currentColor" stroke-width="2" fill="none"/>
            <circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="2" fill="none"/>
            <circle cx="17.5" cy="6.5" r="1.5" fill="currentColor"/>
          </svg>
        </span>
        <span>Instagram</span>
      </a>
      <a href="https://wa.me/40771728217" target="_blank" class="contact-link">
        <span class="contact-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
          </svg>
        </span>
        <span>WhatsApp</span>
      </a>
      <a href="https://www.facebook.com/share/1FnburaNfb/" target="_blank" class="contact-link">
        <span class="contact-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
          </svg>
        </span>
        <span>Facebook</span>
      </a>
      <a href="https://www.tiktok.com/@leyr.studio?_r=1&_t=ZN-91kh1RMaZC2" target="_blank" class="contact-link">
        <span class="contact-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
          </svg>
        </span>
        <span>TikTok</span>
      </a>
    </div>
  </div>
</section>

<footer>
  <p>&copy; 2025 Leyr. All rights reserved.</p>
</footer>

<!-- Floating WhatsApp Button for Custom Product (same as Home) -->
<a href="https://wa.me/40771728217?text=Bună!%20Aș%20dori%20să%20comand%20un%20produs%20custom." target="_blank" class="whatsapp-float" aria-label="Comandă produs custom pe WhatsApp">
  <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
  </svg>
  <span class="whatsapp-tooltip" data-i18n="whatsappTooltip">Produs Custom</span>
</a>

</body>
</html>
